name: Sync FlashPipe Demo Package IFlows from Tenant
on:
  workflow_dispatch:
  schedule:
    - cron:  "30 14 * * *" # Runs at 14:30 UTC

jobs:
  sync:
    runs-on: ubuntu-latest
    container:
      image: engswee/flashpipe:3.0.0
    env:
      FLASHPIPE_TMN_HOST: equaliseit.it-cpi023.cfapps.eu20-001.hana.ondemand.com
      FLASHPIPE_OAUTH_HOST: equaliseit.authentication.eu20.hana.ondemand.com
      FLASHPIPE_OAUTH_CLIENTID: ${{ secrets.DEV_CLIENT_ID }}
      FLASHPIPE_OAUTH_CLIENTSECRET: ${{ secrets.DEV_CLIENT_SECRET }}  
    steps:
      - uses: actions/checkout@v3
#      - name: 'Set directories for sync'
#        run: |
#          echo "FLASHPIPE_DIR_GIT_REPO=$GITHUB_WORKSPACE" >> $GITHUB_ENV
#          echo "FLASHPIPE_DIR_ARTIFACTS=$GITHUB_WORKSPACE/FlashPipe Demo" >> $GITHUB_ENV
      - name: 'Sync FlashPipeDemo IFlows'
        run: flashpipe sync
        shell: bash
        env:
          FLASHPIPE_PACKAGE_ID: FlashPipeDemo
          FLASHPIPE_DIR_GIT_REPO: ${{ github.workspace }}
          FLASHPIPE_DIR_ARTIFACTS: ${{ github.workspace }}/FlashPipe Demo
          FLASHPIPE_GIT_COMMIT_MSG: 'Update FlashPipeDemo package contents'
      - name: Push changes
        run: git push
        shell: bash
        env:
          HOME: /root
